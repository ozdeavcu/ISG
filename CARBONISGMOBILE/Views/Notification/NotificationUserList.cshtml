@model List<NotificationModel>
@section BackButton {
  <div class="back-button">
    <a asp-controller="Home" asp-action="Pages">
      <i class="bi bi-arrow-left-short"></i>
    </a>
  </div>
}
@section Scripts{
  <script>
    function elementsSearch() {
      var input = document.getElementById('elementsSearchInput');
      var filter = input.value.toUpperCase();
      var list = document.getElementById("elementsSearchList");
      var listItem = list.getElementsByClassName('affan-element-item');

     for (let i = 0; i < listItem.length; i++) {  
        var a = listItem[i];
        var textValue = a.textContent || a.innerText;
        if (textValue.toUpperCase().indexOf(filter) > -1) {
          listItem[i].style.display = "";
        } else {
          listItem[i].style.display = "none";
        }
      }
    }

  document.getElementById("defaultSelectSm").addEventListener("change", function() {
    var sortOption = this.value;
  var notificationType = '@(Model.FirstOrDefault()?.Type.ToString() ?? "")';

    
    var form = document.getElementById("notificationForm");

    var existingInput = document.getElementById("sortOptionInput");
    existingInput.value = sortOption;
    
    var typeInput = document.getElementById("notificationTypeInput");
    typeInput.value = notificationType;

    form.submit();
});

$(document).ready(function() {
    var selectedValue = '@ViewData["SortOption"]'; 
    var selectElement = document.getElementById("defaultSelectSm");

    if (selectedValue) {
        selectElement.value = selectedValue;
    } else {
        selectElement.value = "1"; 
    }
});


  </script>
}



<div class="page-content-wrapper py-3" id="elementsSearchList">
  @if (TempData["SuccessMessage"] != null)
  {

    <div class="alert custom-alert-one alert-success alert-dismissible fade show" role="alert">
      <i class="bi bi-check-circle"></i>
      @TempData["SuccessMessage"]
      <button class="btn btn-close position-relative p-1 ms-auto" type="button" data-bs-dismiss="alert"
              aria-label="Close"></button>
    </div>
  }
  else if (TempData["ErrorMessage"] != null)
  {

    <div class="alert custom-alert-one alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-x-circle"></i>
      @TempData["ErrorMessage"]
      <button class="btn btn-close position-relative p-1 ms-auto" type="button" data-bs-dismiss="alert"
              aria-label="Close"></button>
    </div>
  }
  <!-- Notifications Area -->
  <div class="notification-area">
    <div class="container">
      <div class="card">
        <div class="card-body p-3">
          <div class="form-group mb-0">
            <input class="form-control" id="elementsSearchInput" type="text" onkeyup="elementsSearch()"
                   placeholder="Ara...">
          </div>
        </div>
      </div>
      <div class="affan-element-item">
        <div class="element-heading-wrapper d-flex justify-content-between">
          <div class="heading-text">
            <h6 class="mt-2" style="font-size:11.8px;">
              @if (Model.Any())
              {
                switch (Model.First().Type)
                {
                  case NotificationType.Incident:
                    @:Uygunsuzluk Bildirimlerim
                    break;
                  case NotificationType.NearMiss:
                    @:Ramak Kala Bildirimlerim
                    break;
                  case NotificationType.ComplaintAndWish:
                    @:Şikayet ve Önerilerim
                    break;
                  case NotificationType.Infringement:
                    @:Uygunsuzluk ve Risk Bildirimlerim
                    break;
                  default:
                    @:Bildirimlerim
                    break;
                }
              }
              else
              {
                @:Bildirimlerim
              }
            </h6>
          </div>
       
 <form   method="get" id="notificationForm">
  <select class="pe-4 form-select form-select-sm" id="defaultSelectSm" name="defaultSelectSm" aria-label="Default select example">
    <option value="1" selected>Son Eklenen</option>
    <option value="2">Eskiden Yeniye</option>
    <option value="3">Yeniden Eskiye</option>
    <option value="4">Başlığa Göre (A-Z)</option>
  </select>

  <input type="hidden" name="sortOption" id="sortOptionInput" />

  <input type="hidden" name="type" id="notificationTypeInput" />
</form>


        </div>
      </div>

      <div id="notificationList">

      @foreach (var item in Model)
      {
        <div class="affan-element-item">
          <a  asp-controller="Notification" asp-action="NotificationUserEdit" asp-route-type="@item.Type" asp-route-id="@item.Id" asp-route-page="List">
            <div class="alert unread custom-alert-three alert-primary" role="alert">
              <i class="bi bi-check2-circle mt-0"></i>
              <div class="alert-text w-75">
                <div class="d-flex">
                  <h6 class="text-truncate" style="font-size:15px;">@item.Title </h6> <span class="mx-2">@item.Date</span>
                </div>
              
                <span class="text-truncate">
                  @(item.Description.Length > 23 ? item.Title.Substring(0, 23) + ".." : item.Description)
                </span>

              </div>
              <i class="bi bi-arrow-right"></i>
            </div>
          </a>
          </div>
        <!-- Single Notification -->
  
      }

      </div>
    </div>
  </div>
</div>